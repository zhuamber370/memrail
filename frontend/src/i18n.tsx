"use client";

import { createContext, useContext, useEffect, useMemo, useState, type ReactNode } from "react";

type Lang = "en" | "zh";

type Dictionary = Record<string, string>;

const dictionaries: Record<Lang, Dictionary> = {
  en: {
    "nav.ideas": "Ideas",
    "nav.tasks": "Tasks",
    "nav.knowledge": "Knowledge",
    "nav.changes": "Changes",
    "nav.audit": "Audit",
    "lang.en": "EN",
    "lang.zh": "中文",

    "tasks.title": "Tasks",
    "tasks.subtitle": "Agent task desk: filter by priority/status/category and review details.",
    "tasks.total": "Total",
    "tasks.filtersTitle": "Filters",
    "tasks.filterPriority": "Priority",
    "tasks.filterStatus": "Status",
    "tasks.filterCategory": "Category",
    "tasks.filterAll": "All",
    "tasks.search": "Search",
    "tasks.searchPlaceholder": "Search title / ID / description",
    "tasks.create": "Create Task",
    "tasks.refresh": "Refresh",
    "tasks.openStudio": "Open Studio",
    "tasks.backToList": "Back to List",
    "tasks.openDetail": "Open Detail",
    "tasks.closeDetail": "Close Detail",
    "tasks.selected": "Selected",
    "tasks.selectAll": "Select all",
    "tasks.bulkCancel": "Bulk Cancel",
    "tasks.archiveSelected": "Archive Selected",
    "tasks.start": "Start",
    "tasks.done": "Done",
    "tasks.cancel": "Cancel",
    "tasks.delete": "Delete",
    "tasks.promptCancelReason": "Enter cancel reason",
    "tasks.promptBulkCancelReason": "Enter cancel reason for selected tasks",
    "tasks.confirmDelete": "Delete this task permanently?",
    "tasks.noticeDeleted": "Task deleted.",
    "tasks.empty": "No tasks in this view.",
    "tasks.detail": "Task Detail",
    "tasks.id": "ID",
    "tasks.detailIdentity": "Identity",
    "tasks.detailPlan": "Planning",
    "tasks.detailContent": "Content",
    "tasks.status": "Status",
    "tasks.priority": "Priority",
    "tasks.due": "Due",
    "tasks.cycle": "Cycle",
    "tasks.blockedBy": "Blocked By",
    "tasks.nextReview": "Next Review",
    "tasks.updated": "Updated",
    "tasks.source": "Source",
    "tasks.topic": "Topic",
    "tasks.type": "Type",
    "tasks.description": "Description",
    "tasks.acceptance": "Acceptance",
    "tasks.nextAction": "Next Action",
    "tasks.cancelReason": "Cancel Reason",
    "tasks.sectionCore": "Core Edit",
    "tasks.sectionAdvanced": "Advanced Fields",
    "tasks.none": "None",
    "tasks.unknownTopic": "Unknown Topic",
    "tasks.readOnly": "Read-only",
    "tasks.archivedReadOnly": "Archived tasks are read-only.",
    "tasks.quickEdit": "Quick Edit",
    "tasks.saveDetail": "Save Detail",
    "tasks.resetDetail": "Reset",
    "tasks.pickOne": "Select a task to view details.",
    "tasks.manageIdeas": "Idea Pool",
    "tasks.manageRoutes": "Execution Flow",
    "tasks.execution.title": "Execution Dashboard",
    "tasks.execution.subtitle": "See execution health, active step, blocked work, and branch state in one view.",
    "tasks.execution.openIdeas": "Open Idea Pool",
    "tasks.execution.openFlows": "Open Execution Flows",
    "tasks.execution.progress": "Progress",
    "tasks.execution.totalSteps": "Total Steps",
    "tasks.execution.currentStep": "Current Step",
    "tasks.execution.noCurrentStep": "No active step",
    "tasks.execution.blockedSteps": "Blocked Steps",
    "tasks.execution.activeBranches": "Active Branches",
    "tasks.execution.flow": "Flow",
    "tasks.execution.loadingFlows": "Loading flows...",
    "tasks.execution.noFlow": "No execution flow for this task yet.",
    "tasks.execution.mapTitle": "Execution Map",
    "tasks.execution.loadingMap": "Loading execution map...",
    "tasks.execution.stepDetail": "Step Detail",
    "tasks.execution.dependencies": "Dependencies",
    "tasks.execution.dependents": "Dependents",
    "tasks.execution.noDependencies": "No dependency",
    "tasks.execution.noDependents": "No downstream step",
    "tasks.execution.logs": "Step Logs",
    "tasks.execution.loadingLogs": "Loading logs...",
    "tasks.execution.noLogs": "No logs yet.",
    "tasks.execution.startHint": "Start this task by defining the first step.",
    "tasks.execution.startGoalPlaceholder": "First step title",
    "tasks.execution.startType": "First step type",
    "tasks.execution.startAction": "Start Task",
    "tasks.execution.startNodeTitle": "Start",
    "tasks.execution.currentGoal": "Current Goal",
    "tasks.execution.noGoalYet": "No goal yet.",
    "tasks.execution.currentLine": "Current Segment",
    "tasks.execution.currentNode": "Current Node",
    "tasks.execution.selectNodeHint": "Select a node, then use the ... menu for add step / status / rename / delete.",
    "tasks.execution.panHint": "Drag the background to pan. Use zoom controls for complex graphs.",
    "tasks.execution.nextGoals": "Next Goals",
    "tasks.execution.noNextGoals": "No direct next goal under current node.",
    "tasks.execution.branchGraphTitle": "Goal Branch Graph",
    "tasks.execution.branchRoot": "Root",
    "tasks.execution.branchLevel": "Depth",
    "tasks.execution.fromNode": "From",
    "tasks.execution.ideaBranches": "Idea Branches",
    "tasks.execution.noIdeaBranches": "No ideas under current goal.",
    "tasks.execution.addStep": "Add Step",
    "tasks.execution.stepTitlePlaceholder": "Step title",
    "tasks.execution.edgeType.refine": "Refine",
    "tasks.execution.edgeType.initiate": "Initiate",
    "tasks.execution.edgeType.handoff": "Handoff",
    "tasks.execution.edgeRuleGoalToGoal": "Goal cannot directly create another goal. Add an idea in between.",
    "tasks.execution.edgeSummary": "Branch Relations",
    "tasks.execution.edgeEmpty": "No branch relation yet.",
    "tasks.execution.addAction": "Create",
    "tasks.execution.applyAction": "Apply",
    "tasks.execution.setStatusAction": "Set Status",
    "tasks.execution.nodeMenuAria": "Node actions",
    "tasks.execution.zoomOut": "Zoom out",
    "tasks.execution.zoomIn": "Zoom in",
    "tasks.execution.resetView": "Reset view",
    "tasks.execution.fitView": "Fit",
    "tasks.execution.inspectorTitle": "Inspector",
    "tasks.execution.inspectorEmpty": "Select a node or edge to edit description.",
    "tasks.execution.inspectorNode": "Node",
    "tasks.execution.inspectorEdge": "Edge",
    "tasks.execution.inspectorFrom": "From",
    "tasks.execution.inspectorTo": "To",
    "tasks.execution.descriptionLabel": "Description",
    "tasks.execution.descriptionPlaceholderNode": "Add node description (hidden in graph by default).",
    "tasks.execution.descriptionPlaceholderEdge": "Add edge description (hidden in graph by default).",
    "tasks.execution.saveDescription": "Save Description",
    "tasks.execution.renameAction": "Rename",
    "tasks.execution.renamePrompt": "Enter new node title",
    "tasks.execution.deleteConfirm": "Delete this node?",
    "tasks.execution.deleteLeafOnly": "Only leaf nodes without successors can be deleted.",
    "tasks.execution.predecessorHint": "Every new step must choose a predecessor node.",
    "tasks.execution.predecessorLabel": "Predecessor",
    "tasks.execution.noPredecessorAnchor": "No available predecessor",
    "tasks.execution.stepStatus": "Status",
    "tasks.placeholderTitle": "New task title",
    "tasks.placeholderDescription": "Add context and constraints",
    "tasks.placeholderAcceptance": "Define done condition",
    "tasks.placeholderNextAction": "What is the next concrete action?",
    "tasks.placeholderBlockedBy": "Task ID or leave empty",
    "tasks.placeholderCancelReason": "Why is this task cancelled?",
    "tasks.noticeCreated": "Task created.",
    "tasks.noticeUpdated": "Task updated",
    "tasks.noticeCancelled": "Task cancelled.",
    "tasks.noticeBulkCancelled": "Bulk cancelled",
    "tasks.noticeDetailSaved": "Details saved.",
    "tasks.noticeNoChange": "No changes to save.",
    "tasks.noticeArchived": "Archived cancelled tasks",
    "tasks.errTransition": "Status transition is not allowed. Reopen first.",
    "tasks.errCancelReasonRequired": "Cancel reason is required when status is cancelled.",
    "tasks.errNotFound": "Task not found. It may have been removed.",
    "tasks.errTopic": "Category not found. Refresh and retry.",
    "tasks.errValidation": "Invalid input. Check due/status fields.",
    "tasks.statusValue.all": "All",
    "tasks.statusValue.todo": "Todo",
    "tasks.statusValue.in_progress": "In Progress",
    "tasks.statusValue.done": "Done",
    "tasks.statusValue.cancelled": "Cancelled",
    "tasks.statusValue.archived": "Archived",
    "tasks.typeValue.build": "Build",
    "tasks.typeValue.research": "Research",
    "tasks.typeValue.ops": "Ops",
    "tasks.typeValue.writing": "Writing",
    "tasks.typeValue.decision": "Decision",

    "tasks.view.today": "Today",
    "tasks.view.overdue": "Overdue",
    "tasks.view.this_week": "This Week",
    "tasks.view.backlog": "Backlog",
    "tasks.view.blocked": "Blocked",
    "tasks.view.done": "Done",

    "changes.title": "Changes",
    "changes.subtitle": "Batch writes must go through Dry-run -> Diff -> Commit.",
    "changes.actionsJson": "Actions JSON",
    "changes.dryRun": "Dry-run",
    "changes.commit": "Commit",
    "changes.undo": "Undo Last",
    "changes.pendingDry": "Dry-running...",
    "changes.pendingCommit": "Committing...",
    "changes.pendingReject": "Rejecting...",
    "changes.pendingUndo": "Undoing...",
    "changes.refreshInbox": "Refresh Inbox",
    "changes.commitSelected": "Commit Selected",
    "changes.rejectSelected": "Reject Selected",
    "changes.inboxEmpty": "No proposed changes right now.",
    "changes.selectProposal": "Select a proposal to review details.",
    "changes.proposalCount": "Actions",
    "changes.proposalActor": "Actor",
    "changes.proposalTool": "Tool",
    "changes.proposalCreatedAt": "Created",
    "changes.noticeCommitted": "Committed selected proposal.",
    "changes.noticeRejected": "Rejected selected proposal.",
    "changes.noticeUndone": "Undo completed.",
    "changes.errNeedSelect": "Please select a proposal first.",
    "changes.summary": "Dry-run Summary",
    "changes.entity": "Entity",
    "changes.fields": "Fields",
    "changes.diffLedger": "Diff Ledger",
    "changes.taskOnly": "Show task changes only",
    "changes.noTaskChanges": "No task changes in current result.",
    "changes.commitResult": "Commit Result",
    "changes.undoResult": "Undo Result",
    "changes.fieldChanges": "Field changes",
    "changes.appliedActions": "Applied Actions",
    "changes.noAppliedActions": "No applied actions found for this commit.",

    "knowledge.title": "Knowledge",
    "knowledge.subtitle": "Browse by topic, clean up unclassified notes, and review body-first details.",
    "knowledge.append": "Append Note",
    "knowledge.save": "Save",
    "knowledge.archive": "Archive",
    "knowledge.delete": "Delete",
    "knowledge.confirmDelete": "Delete this note permanently?",
    "knowledge.topicGroups": "Topic Groups",
    "knowledge.unclassified": "Unclassified",
    "knowledge.topic": "Topic",
    "knowledge.tags": "Tags",
    "knowledge.updated": "Updated",
    "knowledge.sourceCount": "Sources",
    "knowledge.sources": "Sources",
    "knowledge.linkedTasks": "Linked Tasks",
    "knowledge.linkedNotes": "Linked Notes",
    "knowledge.detail": "Detail",
    "knowledge.selectAll": "Select all",
    "knowledge.selected": "Selected",
    "knowledge.bulkClassify": "Bulk Classify",
    "knowledge.statusActive": "Active",
    "knowledge.statusArchived": "Archived",
    "knowledge.readOnlyHint": "Archived notes are read-only.",
    "knowledge.emptyList": "No notes in this view.",
    "knowledge.emptyDetail": "Select a note to view details.",
    "knowledge.noticeAppended": "Note appended.",
    "knowledge.noticeUpdated": "Note updated.",
    "knowledge.noticeArchived": "Note archived.",
    "knowledge.noticeDeleted": "Note deleted.",
    "knowledge.noticeClassified": "Classified",
    "knowledge.noticeNoChange": "No changes to save.",
    "knowledge.errValidation": "Title, body, and source are required.",
    "knowledge.placeholderSearch": "Search title/body",
    "knowledge.placeholderTag": "Filter by tag",
    "knowledge.placeholderTitle": "Title",
    "knowledge.placeholderBody": "Body",
    "knowledge.placeholderTags": "tag1, tag2",
    "knowledge.placeholderSource": "source",

    "ideas.title": "Ideas",
    "ideas.subtitle": "Capture product or technical ideas, then promote ready items into route nodes.",
    "ideas.create": "Create Idea",
    "ideas.refresh": "Refresh",
    "ideas.filterStatus": "Status",
    "ideas.filterAll": "All",
    "ideas.placeholderTitle": "Idea title",
    "ideas.placeholderSource": "source",
    "ideas.placeholderProblem": "What problem does this solve?",
    "ideas.placeholderHypothesis": "What do you expect to happen?",
    "ideas.emptyList": "No ideas in this view.",
    "ideas.emptyDetail": "Select an idea to inspect and operate.",
    "ideas.detail": "Idea Detail",
    "ideas.problem": "Problem",
    "ideas.hypothesis": "Hypothesis",
    "ideas.source": "Source",
    "ideas.status": "Status",
    "ideas.updated": "Updated",
    "ideas.saveStatus": "Save Status",
    "ideas.promote": "Promote To Flow",
    "ideas.promoteRoute": "Flow",
    "ideas.promoteNodeType": "Step Type",
    "ideas.promoteAction": "Promote",
    "ideas.promoteNeedReady": "Idea must be ready before promotion into a step.",
    "ideas.noticeCreated": "Idea created.",
    "ideas.noticeUpdated": "Idea updated.",
    "ideas.noticePromoted": "Idea promoted to route node.",
    "ideas.errNeedRoute": "Please select a target route.",
    "ideas.contextRequired": "Ideas are nested under a task. Open this page from a task detail.",
    "ideas.contextTask": "Task",
    "ideas.status.captured": "Captured",
    "ideas.status.triage": "Triage",
    "ideas.status.discovery": "Discovery",
    "ideas.status.ready": "Ready",
    "ideas.status.rejected": "Rejected",

    "routes.title": "Execution Flows",
    "routes.subtitle": "Manage task-level idea-goal execution flow.",
    "routes.create": "Create Flow",
    "routes.refresh": "Refresh",
    "routes.filterStatus": "Status",
    "routes.filterAll": "All",
    "routes.placeholderName": "Flow name",
    "routes.placeholderGoal": "Flow goal",
    "routes.placeholderOwner": "Owner",
    "routes.placeholderParentRouteId": "Parent route ID (optional)",
    "routes.emptyList": "No flows in this view.",
    "routes.emptyDetail": "Select a flow to inspect execution details.",
    "routes.detail": "Flow Detail",
    "routes.goal": "Goal",
    "routes.owner": "Owner",
    "routes.priority": "Priority",
    "routes.status": "Status",
    "routes.updated": "Updated",
    "routes.saveStatus": "Save Status",
    "routes.nodeCreate": "Add Step",
    "routes.nodeType": "Step Type",
    "routes.nodeTitle": "Step title",
    "routes.nodeDescription": "Step description",
    "routes.nodeCreateAction": "Create Step",
    "routes.parentRoute": "Parent Route",
    "routes.parentNode": "Parent Node",
    "routes.graphTitle": "Execution Map (Read-only)",
    "routes.graphEmpty": "No steps yet. Add steps to build the execution map.",
    "routes.noticeCreated": "Flow created.",
    "routes.noticeUpdated": "Flow updated.",
    "routes.noticeNodeCreated": "Step created.",
    "routes.contextRequired": "Execution flows are nested under a task. Open this page from a task detail.",
    "routes.contextTask": "Task",
    "routes.nodeType.start": "Start",
    "routes.nodeType.goal": "Goal",
    "routes.nodeType.idea": "Idea",
    "routes.status.candidate": "Candidate",
    "routes.status.active": "Active",
    "routes.status.parked": "Parked",
    "routes.status.completed": "Completed",
    "routes.status.cancelled": "Cancelled",
    "routes.nodeStatus.waiting": "Waiting",
    "routes.nodeStatus.execute": "Execute",
    "routes.nodeStatus.removed": "Removed",
    "routes.nodeStatus.todo": "Todo",
    "routes.nodeStatus.in_progress": "In Progress",
    "routes.nodeStatus.done": "Done",
    "routes.nodeStatus.cancelled": "Cancelled",

    "audit.title": "Audit",
    "audit.subtitle": "Track who/when/tool/action/target/source.",
    "audit.load": "Load Events",
    "audit.applyFilters": "Apply Filters",
    "audit.clearFilters": "Clear",
    "audit.filterAction": "Action",
    "audit.filterTool": "Tool",
    "audit.filterActorType": "Actor Type",
    "audit.filterActorId": "Actor ID",
    "audit.filterTargetType": "Target Type",
    "audit.filterTargetId": "Target ID",
    "audit.empty": "No events matched the current filters.",
    "audit.eventTime": "Time",
    "audit.eventActor": "Actor",
    "audit.eventTool": "Tool",
    "audit.eventAction": "Action",
    "audit.eventTarget": "Target",
    "audit.eventSource": "Source",
    "audit.eventMetadata": "Metadata"
  },
  zh: {
    "nav.ideas": "想法",
    "nav.tasks": "任务",
    "nav.knowledge": "知识",
    "nav.changes": "变更",
    "nav.audit": "审计",
    "lang.en": "EN",
    "lang.zh": "中文",

    "tasks.title": "任务",
    "tasks.subtitle": "Agent 任务台：按优先级/状态/分类筛选并审阅详情。",
    "tasks.total": "总数",
    "tasks.filtersTitle": "筛选",
    "tasks.filterPriority": "优先级",
    "tasks.filterStatus": "状态",
    "tasks.filterCategory": "分类",
    "tasks.filterAll": "全部",
    "tasks.search": "搜索",
    "tasks.searchPlaceholder": "搜索标题 / ID / 描述",
    "tasks.create": "创建任务",
    "tasks.refresh": "刷新",
    "tasks.openStudio": "进入执行",
    "tasks.backToList": "返回列表",
    "tasks.openDetail": "打开详情",
    "tasks.closeDetail": "收起详情",
    "tasks.selected": "已选",
    "tasks.selectAll": "全选",
    "tasks.bulkCancel": "批量取消",
    "tasks.archiveSelected": "归档选中",
    "tasks.start": "开始",
    "tasks.done": "完成",
    "tasks.cancel": "取消",
    "tasks.delete": "删除",
    "tasks.promptCancelReason": "请输入取消原因",
    "tasks.promptBulkCancelReason": "请输入选中任务的取消原因",
    "tasks.confirmDelete": "确定永久删除该任务吗？",
    "tasks.noticeDeleted": "任务已删除。",
    "tasks.empty": "当前视图暂无任务。",
    "tasks.detail": "任务详情",
    "tasks.id": "ID",
    "tasks.detailIdentity": "身份信息",
    "tasks.detailPlan": "计划信息",
    "tasks.detailContent": "内容信息",
    "tasks.status": "状态",
    "tasks.priority": "优先级",
    "tasks.due": "截止日期",
    "tasks.cycle": "周期",
    "tasks.blockedBy": "阻塞来源",
    "tasks.nextReview": "下次复盘",
    "tasks.updated": "更新时间",
    "tasks.source": "来源",
    "tasks.topic": "主题",
    "tasks.type": "类型",
    "tasks.description": "描述",
    "tasks.acceptance": "完成标准",
    "tasks.nextAction": "下一步",
    "tasks.cancelReason": "取消原因",
    "tasks.sectionCore": "高频编辑",
    "tasks.sectionAdvanced": "高级字段",
    "tasks.none": "无",
    "tasks.unknownTopic": "未分类主题",
    "tasks.readOnly": "只读",
    "tasks.archivedReadOnly": "归档任务仅可查看，不能编辑。",
    "tasks.quickEdit": "快捷编辑",
    "tasks.saveDetail": "保存详情",
    "tasks.resetDetail": "重置",
    "tasks.pickOne": "请选择一个任务查看详情。",
    "tasks.manageIdeas": "想法池",
    "tasks.manageRoutes": "执行流",
    "tasks.execution.title": "执行总览",
    "tasks.execution.subtitle": "在一个视图中查看执行健康度、当前步骤、阻塞项和分支状态。",
    "tasks.execution.openIdeas": "打开想法池",
    "tasks.execution.openFlows": "打开执行流",
    "tasks.execution.progress": "进度",
    "tasks.execution.totalSteps": "步骤总数",
    "tasks.execution.currentStep": "当前步骤",
    "tasks.execution.noCurrentStep": "暂无进行中步骤",
    "tasks.execution.blockedSteps": "阻塞步骤",
    "tasks.execution.activeBranches": "活跃分支",
    "tasks.execution.flow": "执行流",
    "tasks.execution.loadingFlows": "正在加载执行流...",
    "tasks.execution.noFlow": "当前任务还没有执行流。",
    "tasks.execution.mapTitle": "执行图",
    "tasks.execution.loadingMap": "正在加载执行图...",
    "tasks.execution.stepDetail": "步骤详情",
    "tasks.execution.dependencies": "前置依赖",
    "tasks.execution.dependents": "后续步骤",
    "tasks.execution.noDependencies": "无依赖",
    "tasks.execution.noDependents": "无后续步骤",
    "tasks.execution.logs": "步骤日志",
    "tasks.execution.loadingLogs": "正在加载日志...",
    "tasks.execution.noLogs": "暂无日志。",
    "tasks.execution.startHint": "开始任务时请先定义首个步骤。",
    "tasks.execution.startGoalPlaceholder": "首个步骤标题",
    "tasks.execution.startType": "首个步骤类型",
    "tasks.execution.startAction": "开始任务",
    "tasks.execution.startNodeTitle": "开始",
    "tasks.execution.currentGoal": "当前目标",
    "tasks.execution.noGoalYet": "暂无目标。",
    "tasks.execution.currentLine": "当前线段",
    "tasks.execution.currentNode": "当前节点",
    "tasks.execution.selectNodeHint": "先选中节点，再点右上角 ... 进行新增步骤 / 状态 / 重命名 / 删除。",
    "tasks.execution.panHint": "拖动画布空白区可平移，配合缩放可浏览复杂 DAG。",
    "tasks.execution.nextGoals": "后置目标",
    "tasks.execution.noNextGoals": "当前节点下暂无直接后置目标。",
    "tasks.execution.branchGraphTitle": "目标分支图",
    "tasks.execution.branchRoot": "根节点",
    "tasks.execution.branchLevel": "层级",
    "tasks.execution.fromNode": "来自",
    "tasks.execution.ideaBranches": "想法分支",
    "tasks.execution.noIdeaBranches": "当前目标下暂无想法。",
    "tasks.execution.addStep": "新增步骤",
    "tasks.execution.stepTitlePlaceholder": "步骤标题",
    "tasks.execution.edgeType.refine": "细化",
    "tasks.execution.edgeType.initiate": "立项",
    "tasks.execution.edgeType.handoff": "衔接",
    "tasks.execution.edgeRuleGoalToGoal": "目标后不能直接接目标，请先新增一个想法节点。",
    "tasks.execution.edgeSummary": "分支关系",
    "tasks.execution.edgeEmpty": "暂无分支关系。",
    "tasks.execution.addAction": "创建",
    "tasks.execution.applyAction": "应用",
    "tasks.execution.setStatusAction": "设置状态",
    "tasks.execution.nodeMenuAria": "节点操作",
    "tasks.execution.zoomOut": "缩小",
    "tasks.execution.zoomIn": "放大",
    "tasks.execution.resetView": "重置视图",
    "tasks.execution.fitView": "适配画布",
    "tasks.execution.inspectorTitle": "检查面板",
    "tasks.execution.inspectorEmpty": "选择节点或连线后可编辑描述。",
    "tasks.execution.inspectorNode": "节点",
    "tasks.execution.inspectorEdge": "连线",
    "tasks.execution.inspectorFrom": "起点",
    "tasks.execution.inspectorTo": "终点",
    "tasks.execution.descriptionLabel": "描述",
    "tasks.execution.descriptionPlaceholderNode": "补充节点描述（默认不在图上展示）。",
    "tasks.execution.descriptionPlaceholderEdge": "补充连线描述（默认不在图上展示）。",
    "tasks.execution.saveDescription": "保存描述",
    "tasks.execution.renameAction": "重命名",
    "tasks.execution.renamePrompt": "请输入新的节点标题",
    "tasks.execution.deleteConfirm": "确认删除该节点？",
    "tasks.execution.deleteLeafOnly": "仅能删除没有后续节点的叶子节点。",
    "tasks.execution.predecessorHint": "每个新步骤都必须选择前置节点。",
    "tasks.execution.predecessorLabel": "前置节点",
    "tasks.execution.noPredecessorAnchor": "暂无可用前置节点",
    "tasks.execution.stepStatus": "状态",
    "tasks.placeholderTitle": "新任务标题",
    "tasks.placeholderDescription": "补充任务背景与约束",
    "tasks.placeholderAcceptance": "定义完成标准",
    "tasks.placeholderNextAction": "下一步要执行什么？",
    "tasks.placeholderBlockedBy": "填写阻塞任务 ID，或留空",
    "tasks.placeholderCancelReason": "请说明取消原因",
    "tasks.noticeCreated": "任务已创建。",
    "tasks.noticeUpdated": "任务已更新",
    "tasks.noticeCancelled": "任务已取消。",
    "tasks.noticeBulkCancelled": "批量取消完成",
    "tasks.noticeDetailSaved": "详情已保存。",
    "tasks.noticeNoChange": "没有需要保存的变更。",
    "tasks.noticeArchived": "已归档取消任务",
    "tasks.errTransition": "状态流不允许该变更，请先 Reopen 再推进状态。",
    "tasks.errCancelReasonRequired": "当状态为已取消时，必须填写取消原因。",
    "tasks.errNotFound": "任务不存在，可能已被删除或视图过期。",
    "tasks.errTopic": "分类不存在，请刷新后重试。",
    "tasks.errValidation": "输入字段不合法，请检查 due/status 字段。",
    "tasks.statusValue.all": "全部",
    "tasks.statusValue.todo": "待办",
    "tasks.statusValue.in_progress": "进行中",
    "tasks.statusValue.done": "已完成",
    "tasks.statusValue.cancelled": "已取消",
    "tasks.statusValue.archived": "已归档",
    "tasks.typeValue.build": "开发",
    "tasks.typeValue.research": "调研",
    "tasks.typeValue.ops": "运维",
    "tasks.typeValue.writing": "写作",
    "tasks.typeValue.decision": "决策",

    "tasks.view.today": "今天",
    "tasks.view.overdue": "已逾期",
    "tasks.view.this_week": "本周",
    "tasks.view.backlog": "待整理",
    "tasks.view.blocked": "被阻塞",
    "tasks.view.done": "已完成",

    "changes.title": "变更",
    "changes.subtitle": "批量写入必须经过 Dry-run -> Diff -> Commit。",
    "changes.actionsJson": "动作 JSON",
    "changes.dryRun": "预检",
    "changes.commit": "提交",
    "changes.undo": "回滚最近一次",
    "changes.pendingDry": "预检中...",
    "changes.pendingCommit": "提交中...",
    "changes.pendingReject": "拒绝中...",
    "changes.pendingUndo": "回滚中...",
    "changes.refreshInbox": "刷新收件箱",
    "changes.commitSelected": "提交所选提案",
    "changes.rejectSelected": "拒绝所选提案",
    "changes.inboxEmpty": "当前没有待审提案。",
    "changes.selectProposal": "请选择左侧提案查看详情。",
    "changes.proposalCount": "动作数",
    "changes.proposalActor": "执行者",
    "changes.proposalTool": "工具",
    "changes.proposalCreatedAt": "创建时间",
    "changes.noticeCommitted": "所选提案已提交。",
    "changes.noticeRejected": "所选提案已拒绝并删除。",
    "changes.noticeUndone": "回滚完成。",
    "changes.errNeedSelect": "请先选择一个提案。",
    "changes.summary": "预检摘要",
    "changes.entity": "实体",
    "changes.fields": "字段",
    "changes.diffLedger": "差异台账",
    "changes.taskOnly": "仅看任务变更",
    "changes.noTaskChanges": "当前结果没有任务变更。",
    "changes.commitResult": "提交结果",
    "changes.undoResult": "回滚结果",
    "changes.fieldChanges": "字段变化",
    "changes.appliedActions": "执行明细",
    "changes.noAppliedActions": "该次提交未查询到执行明细。",

    "knowledge.title": "知识",
    "knowledge.subtitle": "按主题浏览、清理未归类、并以正文优先审阅。",
    "knowledge.append": "追加笔记",
    "knowledge.save": "保存",
    "knowledge.archive": "归档",
    "knowledge.delete": "删除",
    "knowledge.confirmDelete": "确定永久删除该笔记吗？",
    "knowledge.topicGroups": "主题分组",
    "knowledge.unclassified": "未归类",
    "knowledge.topic": "主题",
    "knowledge.tags": "标签",
    "knowledge.updated": "更新时间",
    "knowledge.sourceCount": "来源数",
    "knowledge.sources": "来源",
    "knowledge.linkedTasks": "关联任务",
    "knowledge.linkedNotes": "关联笔记",
    "knowledge.detail": "详情",
    "knowledge.selectAll": "全选",
    "knowledge.selected": "已选",
    "knowledge.bulkClassify": "批量归类",
    "knowledge.statusActive": "生效中",
    "knowledge.statusArchived": "已归档",
    "knowledge.readOnlyHint": "归档笔记仅可查看。",
    "knowledge.emptyList": "当前视图暂无笔记。",
    "knowledge.emptyDetail": "请选择一条笔记查看详情。",
    "knowledge.noticeAppended": "笔记已追加。",
    "knowledge.noticeUpdated": "笔记已更新。",
    "knowledge.noticeArchived": "笔记已归档。",
    "knowledge.noticeDeleted": "笔记已删除。",
    "knowledge.noticeClassified": "归类完成",
    "knowledge.noticeNoChange": "没有可保存的变更。",
    "knowledge.errValidation": "标题、正文和来源为必填。",
    "knowledge.placeholderSearch": "搜索标题或正文",
    "knowledge.placeholderTag": "按标签筛选",
    "knowledge.placeholderTitle": "标题",
    "knowledge.placeholderBody": "正文",
    "knowledge.placeholderTags": "标签1, 标签2",
    "knowledge.placeholderSource": "来源",

    "ideas.title": "想法",
    "ideas.subtitle": "先收集产品/技术想法，再把就绪想法提升为路线节点。",
    "ideas.create": "创建想法",
    "ideas.refresh": "刷新",
    "ideas.filterStatus": "状态",
    "ideas.filterAll": "全部",
    "ideas.placeholderTitle": "想法标题",
    "ideas.placeholderSource": "来源",
    "ideas.placeholderProblem": "这个想法解决什么问题？",
    "ideas.placeholderHypothesis": "你希望验证什么假设？",
    "ideas.emptyList": "当前视图暂无想法。",
    "ideas.emptyDetail": "请选择一个想法查看和操作。",
    "ideas.detail": "想法详情",
    "ideas.problem": "问题",
    "ideas.hypothesis": "假设",
    "ideas.source": "来源",
    "ideas.status": "状态",
    "ideas.updated": "更新时间",
    "ideas.saveStatus": "保存状态",
    "ideas.promote": "提升到执行流",
    "ideas.promoteRoute": "目标执行流",
    "ideas.promoteNodeType": "步骤类型",
    "ideas.promoteAction": "执行提升",
    "ideas.promoteNeedReady": "只有 ready 状态的想法才能提升为步骤。",
    "ideas.noticeCreated": "想法已创建。",
    "ideas.noticeUpdated": "想法已更新。",
    "ideas.noticePromoted": "想法已提升为路线节点。",
    "ideas.errNeedRoute": "请先选择目标路线。",
    "ideas.contextRequired": "想法属于任务下级，请从任务详情进入该页面。",
    "ideas.contextTask": "任务",
    "ideas.status.captured": "已捕获",
    "ideas.status.triage": "已分诊",
    "ideas.status.discovery": "调研中",
    "ideas.status.ready": "已就绪",
    "ideas.status.rejected": "已拒绝",

    "routes.title": "执行流",
    "routes.subtitle": "管理任务级想法-目标执行流。",
    "routes.create": "创建执行流",
    "routes.refresh": "刷新",
    "routes.filterStatus": "状态",
    "routes.filterAll": "全部",
    "routes.placeholderName": "执行流名称",
    "routes.placeholderGoal": "执行流目标",
    "routes.placeholderOwner": "负责人",
    "routes.placeholderParentRouteId": "父执行流 ID（可选）",
    "routes.emptyList": "当前视图暂无执行流。",
    "routes.emptyDetail": "请选择一条执行流查看详情。",
    "routes.detail": "执行流详情",
    "routes.goal": "目标",
    "routes.owner": "负责人",
    "routes.priority": "优先级",
    "routes.status": "状态",
    "routes.updated": "更新时间",
    "routes.saveStatus": "保存状态",
    "routes.nodeCreate": "新增步骤",
    "routes.nodeType": "步骤类型",
    "routes.nodeTitle": "步骤标题",
    "routes.nodeDescription": "步骤描述",
    "routes.nodeCreateAction": "创建步骤",
    "routes.parentRoute": "父执行流",
    "routes.parentNode": "父节点",
    "routes.graphTitle": "执行图（只读）",
    "routes.graphEmpty": "暂无步骤，先新增步骤即可生成执行图。",
    "routes.noticeCreated": "执行流已创建。",
    "routes.noticeUpdated": "执行流已更新。",
    "routes.noticeNodeCreated": "步骤已创建。",
    "routes.contextRequired": "执行流属于任务下级，请从任务详情进入该页面。",
    "routes.contextTask": "任务",
    "routes.nodeType.start": "开始",
    "routes.nodeType.goal": "目标",
    "routes.nodeType.idea": "想法",
    "routes.status.candidate": "候选",
    "routes.status.active": "执行中",
    "routes.status.parked": "暂挂",
    "routes.status.completed": "已完成",
    "routes.status.cancelled": "已取消",
    "routes.nodeStatus.waiting": "等待",
    "routes.nodeStatus.execute": "执行中",
    "routes.nodeStatus.removed": "已移除",
    "routes.nodeStatus.todo": "待办",
    "routes.nodeStatus.in_progress": "进行中",
    "routes.nodeStatus.done": "已完成",
    "routes.nodeStatus.cancelled": "已取消",

    "audit.title": "审计",
    "audit.subtitle": "追踪 who/when/tool/action/target/source。",
    "audit.load": "加载事件",
    "audit.applyFilters": "应用筛选",
    "audit.clearFilters": "清空",
    "audit.filterAction": "动作",
    "audit.filterTool": "工具",
    "audit.filterActorType": "操作者类型",
    "audit.filterActorId": "操作者ID",
    "audit.filterTargetType": "目标类型",
    "audit.filterTargetId": "目标ID",
    "audit.empty": "当前筛选下没有事件。",
    "audit.eventTime": "时间",
    "audit.eventActor": "操作者",
    "audit.eventTool": "工具",
    "audit.eventAction": "动作",
    "audit.eventTarget": "目标",
    "audit.eventSource": "来源",
    "audit.eventMetadata": "元数据"
  }
};

type I18nValue = {
  lang: Lang;
  setLang: (lang: Lang) => void;
  t: (key: string) => string;
};

const I18nContext = createContext<I18nValue | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLang] = useState<Lang>("en");

  useEffect(() => {
    const saved = window.localStorage.getItem("afkms_lang");
    if (saved === "en" || saved === "zh") {
      setLang(saved);
    }
  }, []);

  useEffect(() => {
    window.localStorage.setItem("afkms_lang", lang);
    document.documentElement.lang = lang === "zh" ? "zh-CN" : "en";
  }, [lang]);

  const value = useMemo<I18nValue>(
    () => ({
      lang,
      setLang,
      t: (key: string) => dictionaries[lang][key] ?? key
    }),
    [lang]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
}
