"use client";

import { createContext, useContext, useEffect, useMemo, useState, type ReactNode } from "react";

type Lang = "en" | "zh";

type Dictionary = Record<string, string>;

const dictionaries: Record<Lang, Dictionary> = {
  en: {
    "nav.ideas": "Ideas",
    "nav.routes": "Routes",
    "nav.tasks": "Tasks",
    "nav.knowledge": "Knowledge",
    "nav.changes": "Changes",
    "nav.audit": "Audit",
    "lang.en": "EN",
    "lang.zh": "中文",

    "tasks.title": "Tasks",
    "tasks.subtitle": "Agent task desk: filter by priority/status/category and review details.",
    "tasks.total": "Total",
    "tasks.filtersTitle": "Filters",
    "tasks.filterPriority": "Priority",
    "tasks.filterStatus": "Status",
    "tasks.filterCategory": "Category",
    "tasks.filterAll": "All",
    "tasks.create": "Create Task",
    "tasks.refresh": "Refresh",
    "tasks.selected": "Selected",
    "tasks.selectAll": "Select all",
    "tasks.bulkCancel": "Bulk Cancel",
    "tasks.archiveSelected": "Archive Selected",
    "tasks.start": "Start",
    "tasks.done": "Done",
    "tasks.cancel": "Cancel",
    "tasks.delete": "Delete",
    "tasks.promptCancelReason": "Enter cancel reason",
    "tasks.promptBulkCancelReason": "Enter cancel reason for selected tasks",
    "tasks.confirmDelete": "Delete this task permanently?",
    "tasks.noticeDeleted": "Task deleted.",
    "tasks.empty": "No tasks in this view.",
    "tasks.detail": "Task Detail",
    "tasks.status": "Status",
    "tasks.priority": "Priority",
    "tasks.due": "Due",
    "tasks.cycle": "Cycle",
    "tasks.blockedBy": "Blocked By",
    "tasks.nextReview": "Next Review",
    "tasks.updated": "Updated",
    "tasks.source": "Source",
    "tasks.topic": "Topic",
    "tasks.type": "Type",
    "tasks.description": "Description",
    "tasks.acceptance": "Acceptance",
    "tasks.nextAction": "Next Action",
    "tasks.cancelReason": "Cancel Reason",
    "tasks.sectionCore": "Core Edit",
    "tasks.sectionAdvanced": "Advanced Fields",
    "tasks.none": "None",
    "tasks.unknownTopic": "Unknown Topic",
    "tasks.readOnly": "Read-only",
    "tasks.archivedReadOnly": "Archived tasks are read-only.",
    "tasks.quickEdit": "Quick Edit",
    "tasks.saveDetail": "Save Detail",
    "tasks.resetDetail": "Reset",
    "tasks.pickOne": "Select a task to view details.",
    "tasks.placeholderTitle": "New task title",
    "tasks.placeholderDescription": "Add context and constraints",
    "tasks.placeholderAcceptance": "Define done condition",
    "tasks.placeholderNextAction": "What is the next concrete action?",
    "tasks.placeholderBlockedBy": "Task ID or leave empty",
    "tasks.placeholderCancelReason": "Why is this task cancelled?",
    "tasks.noticeCreated": "Task created.",
    "tasks.noticeUpdated": "Task updated",
    "tasks.noticeCancelled": "Task cancelled.",
    "tasks.noticeBulkCancelled": "Bulk cancelled",
    "tasks.noticeDetailSaved": "Details saved.",
    "tasks.noticeNoChange": "No changes to save.",
    "tasks.noticeArchived": "Archived cancelled tasks",
    "tasks.errTransition": "Status transition is not allowed. Reopen first.",
    "tasks.errCancelReasonRequired": "Cancel reason is required when status is cancelled.",
    "tasks.errNotFound": "Task not found. It may have been removed.",
    "tasks.errTopic": "Category not found. Refresh and retry.",
    "tasks.errValidation": "Invalid input. Check due/status fields.",
    "tasks.statusValue.all": "All",
    "tasks.statusValue.todo": "Todo",
    "tasks.statusValue.in_progress": "In Progress",
    "tasks.statusValue.done": "Done",
    "tasks.statusValue.cancelled": "Cancelled",
    "tasks.statusValue.archived": "Archived",
    "tasks.typeValue.build": "Build",
    "tasks.typeValue.research": "Research",
    "tasks.typeValue.ops": "Ops",
    "tasks.typeValue.writing": "Writing",
    "tasks.typeValue.decision": "Decision",

    "tasks.view.today": "Today",
    "tasks.view.overdue": "Overdue",
    "tasks.view.this_week": "This Week",
    "tasks.view.backlog": "Backlog",
    "tasks.view.blocked": "Blocked",
    "tasks.view.done": "Done",

    "changes.title": "Changes",
    "changes.subtitle": "Batch writes must go through Dry-run -> Diff -> Commit.",
    "changes.actionsJson": "Actions JSON",
    "changes.dryRun": "Dry-run",
    "changes.commit": "Commit",
    "changes.undo": "Undo Last",
    "changes.pendingDry": "Dry-running...",
    "changes.pendingCommit": "Committing...",
    "changes.pendingReject": "Rejecting...",
    "changes.pendingUndo": "Undoing...",
    "changes.refreshInbox": "Refresh Inbox",
    "changes.commitSelected": "Commit Selected",
    "changes.rejectSelected": "Reject Selected",
    "changes.inboxEmpty": "No proposed changes right now.",
    "changes.selectProposal": "Select a proposal to review details.",
    "changes.proposalCount": "Actions",
    "changes.proposalActor": "Actor",
    "changes.proposalTool": "Tool",
    "changes.proposalCreatedAt": "Created",
    "changes.noticeCommitted": "Committed selected proposal.",
    "changes.noticeRejected": "Rejected selected proposal.",
    "changes.noticeUndone": "Undo completed.",
    "changes.errNeedSelect": "Please select a proposal first.",
    "changes.summary": "Dry-run Summary",
    "changes.entity": "Entity",
    "changes.fields": "Fields",
    "changes.diffLedger": "Diff Ledger",
    "changes.taskOnly": "Show task changes only",
    "changes.noTaskChanges": "No task changes in current result.",
    "changes.commitResult": "Commit Result",
    "changes.undoResult": "Undo Result",
    "changes.fieldChanges": "Field changes",
    "changes.appliedActions": "Applied Actions",
    "changes.noAppliedActions": "No applied actions found for this commit.",

    "knowledge.title": "Knowledge",
    "knowledge.subtitle": "Browse by topic, clean up unclassified notes, and review body-first details.",
    "knowledge.append": "Append Note",
    "knowledge.save": "Save",
    "knowledge.archive": "Archive",
    "knowledge.delete": "Delete",
    "knowledge.confirmDelete": "Delete this note permanently?",
    "knowledge.topicGroups": "Topic Groups",
    "knowledge.unclassified": "Unclassified",
    "knowledge.topic": "Topic",
    "knowledge.tags": "Tags",
    "knowledge.updated": "Updated",
    "knowledge.sourceCount": "Sources",
    "knowledge.sources": "Sources",
    "knowledge.linkedTasks": "Linked Tasks",
    "knowledge.linkedNotes": "Linked Notes",
    "knowledge.detail": "Detail",
    "knowledge.selectAll": "Select all",
    "knowledge.selected": "Selected",
    "knowledge.bulkClassify": "Bulk Classify",
    "knowledge.statusActive": "Active",
    "knowledge.statusArchived": "Archived",
    "knowledge.readOnlyHint": "Archived notes are read-only.",
    "knowledge.emptyList": "No notes in this view.",
    "knowledge.emptyDetail": "Select a note to view details.",
    "knowledge.noticeAppended": "Note appended.",
    "knowledge.noticeUpdated": "Note updated.",
    "knowledge.noticeArchived": "Note archived.",
    "knowledge.noticeDeleted": "Note deleted.",
    "knowledge.noticeClassified": "Classified",
    "knowledge.noticeNoChange": "No changes to save.",
    "knowledge.errValidation": "Title, body, and source are required.",
    "knowledge.placeholderSearch": "Search title/body",
    "knowledge.placeholderTag": "Filter by tag",
    "knowledge.placeholderTitle": "Title",
    "knowledge.placeholderBody": "Body",
    "knowledge.placeholderTags": "tag1, tag2",
    "knowledge.placeholderSource": "source",

    "ideas.title": "Ideas",
    "ideas.subtitle": "Capture product or technical ideas, then promote ready items into route nodes.",
    "ideas.create": "Create Idea",
    "ideas.refresh": "Refresh",
    "ideas.filterStatus": "Status",
    "ideas.filterAll": "All",
    "ideas.placeholderTitle": "Idea title",
    "ideas.placeholderSource": "source",
    "ideas.placeholderProblem": "What problem does this solve?",
    "ideas.placeholderHypothesis": "What do you expect to happen?",
    "ideas.emptyList": "No ideas in this view.",
    "ideas.emptyDetail": "Select an idea to inspect and operate.",
    "ideas.detail": "Idea Detail",
    "ideas.problem": "Problem",
    "ideas.hypothesis": "Hypothesis",
    "ideas.source": "Source",
    "ideas.status": "Status",
    "ideas.updated": "Updated",
    "ideas.saveStatus": "Save Status",
    "ideas.promote": "Promote To Route",
    "ideas.promoteRoute": "Route",
    "ideas.promoteNodeType": "Node Type",
    "ideas.promoteAction": "Promote",
    "ideas.promoteNeedReady": "Idea must be ready before promotion.",
    "ideas.noticeCreated": "Idea created.",
    "ideas.noticeUpdated": "Idea updated.",
    "ideas.noticePromoted": "Idea promoted to route node.",
    "ideas.errNeedRoute": "Please select a target route.",
    "ideas.status.captured": "Captured",
    "ideas.status.triage": "Triage",
    "ideas.status.discovery": "Discovery",
    "ideas.status.ready": "Ready",
    "ideas.status.rejected": "Rejected",

    "routes.title": "Routes",
    "routes.subtitle": "Manage execution routes and preview node dependencies in a read-only graph.",
    "routes.create": "Create Route",
    "routes.refresh": "Refresh",
    "routes.filterStatus": "Status",
    "routes.filterAll": "All",
    "routes.placeholderName": "Route name",
    "routes.placeholderGoal": "Route goal",
    "routes.placeholderOwner": "Owner",
    "routes.emptyList": "No routes in this view.",
    "routes.emptyDetail": "Select a route to inspect graph details.",
    "routes.detail": "Route Detail",
    "routes.goal": "Goal",
    "routes.owner": "Owner",
    "routes.priority": "Priority",
    "routes.status": "Status",
    "routes.updated": "Updated",
    "routes.saveStatus": "Save Status",
    "routes.nodeCreate": "Add Node",
    "routes.nodeType": "Node Type",
    "routes.nodeTitle": "Node title",
    "routes.nodeDescription": "Node description",
    "routes.nodeCreateAction": "Create Node",
    "routes.graphTitle": "Route Graph (Read-only)",
    "routes.graphEmpty": "No nodes yet. Add nodes to render the route graph.",
    "routes.graphDependsOn": "Depends on",
    "routes.graphBlocks": "Blocks",
    "routes.graphNoDependsOn": "No upstream dependency",
    "routes.graphNoBlocks": "No downstream node",
    "routes.noticeCreated": "Route created.",
    "routes.noticeUpdated": "Route updated.",
    "routes.noticeNodeCreated": "Route node created.",
    "routes.status.candidate": "Candidate",
    "routes.status.active": "Active",
    "routes.status.parked": "Parked",
    "routes.status.completed": "Completed",
    "routes.status.cancelled": "Cancelled",
    "routes.nodeType.decision": "Decision",
    "routes.nodeType.milestone": "Milestone",
    "routes.nodeType.task": "Task",
    "routes.nodeStatus.todo": "Todo",
    "routes.nodeStatus.in_progress": "In Progress",
    "routes.nodeStatus.done": "Done",
    "routes.nodeStatus.cancelled": "Cancelled",

    "audit.title": "Audit",
    "audit.subtitle": "Track who/when/tool/action/target/source.",
    "audit.load": "Load Events",
    "audit.applyFilters": "Apply Filters",
    "audit.clearFilters": "Clear",
    "audit.filterAction": "Action",
    "audit.filterTool": "Tool",
    "audit.filterActorType": "Actor Type",
    "audit.filterActorId": "Actor ID",
    "audit.filterTargetType": "Target Type",
    "audit.filterTargetId": "Target ID",
    "audit.empty": "No events matched the current filters.",
    "audit.eventTime": "Time",
    "audit.eventActor": "Actor",
    "audit.eventTool": "Tool",
    "audit.eventAction": "Action",
    "audit.eventTarget": "Target",
    "audit.eventSource": "Source",
    "audit.eventMetadata": "Metadata"
  },
  zh: {
    "nav.ideas": "想法",
    "nav.routes": "路线",
    "nav.tasks": "任务",
    "nav.knowledge": "知识",
    "nav.changes": "变更",
    "nav.audit": "审计",
    "lang.en": "EN",
    "lang.zh": "中文",

    "tasks.title": "任务",
    "tasks.subtitle": "Agent 任务台：按优先级/状态/分类筛选并审阅详情。",
    "tasks.total": "总数",
    "tasks.filtersTitle": "筛选",
    "tasks.filterPriority": "优先级",
    "tasks.filterStatus": "状态",
    "tasks.filterCategory": "分类",
    "tasks.filterAll": "全部",
    "tasks.create": "创建任务",
    "tasks.refresh": "刷新",
    "tasks.selected": "已选",
    "tasks.selectAll": "全选",
    "tasks.bulkCancel": "批量取消",
    "tasks.archiveSelected": "归档选中",
    "tasks.start": "开始",
    "tasks.done": "完成",
    "tasks.cancel": "取消",
    "tasks.delete": "删除",
    "tasks.promptCancelReason": "请输入取消原因",
    "tasks.promptBulkCancelReason": "请输入选中任务的取消原因",
    "tasks.confirmDelete": "确定永久删除该任务吗？",
    "tasks.noticeDeleted": "任务已删除。",
    "tasks.empty": "当前视图暂无任务。",
    "tasks.detail": "任务详情",
    "tasks.status": "状态",
    "tasks.priority": "优先级",
    "tasks.due": "截止日期",
    "tasks.cycle": "周期",
    "tasks.blockedBy": "阻塞来源",
    "tasks.nextReview": "下次复盘",
    "tasks.updated": "更新时间",
    "tasks.source": "来源",
    "tasks.topic": "主题",
    "tasks.type": "类型",
    "tasks.description": "描述",
    "tasks.acceptance": "完成标准",
    "tasks.nextAction": "下一步",
    "tasks.cancelReason": "取消原因",
    "tasks.sectionCore": "高频编辑",
    "tasks.sectionAdvanced": "高级字段",
    "tasks.none": "无",
    "tasks.unknownTopic": "未分类主题",
    "tasks.readOnly": "只读",
    "tasks.archivedReadOnly": "归档任务仅可查看，不能编辑。",
    "tasks.quickEdit": "快捷编辑",
    "tasks.saveDetail": "保存详情",
    "tasks.resetDetail": "重置",
    "tasks.pickOne": "请选择一个任务查看详情。",
    "tasks.placeholderTitle": "新任务标题",
    "tasks.placeholderDescription": "补充任务背景与约束",
    "tasks.placeholderAcceptance": "定义完成标准",
    "tasks.placeholderNextAction": "下一步要执行什么？",
    "tasks.placeholderBlockedBy": "填写阻塞任务 ID，或留空",
    "tasks.placeholderCancelReason": "请说明取消原因",
    "tasks.noticeCreated": "任务已创建。",
    "tasks.noticeUpdated": "任务已更新",
    "tasks.noticeCancelled": "任务已取消。",
    "tasks.noticeBulkCancelled": "批量取消完成",
    "tasks.noticeDetailSaved": "详情已保存。",
    "tasks.noticeNoChange": "没有需要保存的变更。",
    "tasks.noticeArchived": "已归档取消任务",
    "tasks.errTransition": "状态流不允许该变更，请先 Reopen 再推进状态。",
    "tasks.errCancelReasonRequired": "当状态为已取消时，必须填写取消原因。",
    "tasks.errNotFound": "任务不存在，可能已被删除或视图过期。",
    "tasks.errTopic": "分类不存在，请刷新后重试。",
    "tasks.errValidation": "输入字段不合法，请检查 due/status 字段。",
    "tasks.statusValue.all": "全部",
    "tasks.statusValue.todo": "待办",
    "tasks.statusValue.in_progress": "进行中",
    "tasks.statusValue.done": "已完成",
    "tasks.statusValue.cancelled": "已取消",
    "tasks.statusValue.archived": "已归档",
    "tasks.typeValue.build": "开发",
    "tasks.typeValue.research": "调研",
    "tasks.typeValue.ops": "运维",
    "tasks.typeValue.writing": "写作",
    "tasks.typeValue.decision": "决策",

    "tasks.view.today": "今天",
    "tasks.view.overdue": "已逾期",
    "tasks.view.this_week": "本周",
    "tasks.view.backlog": "待整理",
    "tasks.view.blocked": "被阻塞",
    "tasks.view.done": "已完成",

    "changes.title": "变更",
    "changes.subtitle": "批量写入必须经过 Dry-run -> Diff -> Commit。",
    "changes.actionsJson": "动作 JSON",
    "changes.dryRun": "预检",
    "changes.commit": "提交",
    "changes.undo": "回滚最近一次",
    "changes.pendingDry": "预检中...",
    "changes.pendingCommit": "提交中...",
    "changes.pendingReject": "拒绝中...",
    "changes.pendingUndo": "回滚中...",
    "changes.refreshInbox": "刷新收件箱",
    "changes.commitSelected": "提交所选提案",
    "changes.rejectSelected": "拒绝所选提案",
    "changes.inboxEmpty": "当前没有待审提案。",
    "changes.selectProposal": "请选择左侧提案查看详情。",
    "changes.proposalCount": "动作数",
    "changes.proposalActor": "执行者",
    "changes.proposalTool": "工具",
    "changes.proposalCreatedAt": "创建时间",
    "changes.noticeCommitted": "所选提案已提交。",
    "changes.noticeRejected": "所选提案已拒绝并删除。",
    "changes.noticeUndone": "回滚完成。",
    "changes.errNeedSelect": "请先选择一个提案。",
    "changes.summary": "预检摘要",
    "changes.entity": "实体",
    "changes.fields": "字段",
    "changes.diffLedger": "差异台账",
    "changes.taskOnly": "仅看任务变更",
    "changes.noTaskChanges": "当前结果没有任务变更。",
    "changes.commitResult": "提交结果",
    "changes.undoResult": "回滚结果",
    "changes.fieldChanges": "字段变化",
    "changes.appliedActions": "执行明细",
    "changes.noAppliedActions": "该次提交未查询到执行明细。",

    "knowledge.title": "知识",
    "knowledge.subtitle": "按主题浏览、清理未归类、并以正文优先审阅。",
    "knowledge.append": "追加笔记",
    "knowledge.save": "保存",
    "knowledge.archive": "归档",
    "knowledge.delete": "删除",
    "knowledge.confirmDelete": "确定永久删除该笔记吗？",
    "knowledge.topicGroups": "主题分组",
    "knowledge.unclassified": "未归类",
    "knowledge.topic": "主题",
    "knowledge.tags": "标签",
    "knowledge.updated": "更新时间",
    "knowledge.sourceCount": "来源数",
    "knowledge.sources": "来源",
    "knowledge.linkedTasks": "关联任务",
    "knowledge.linkedNotes": "关联笔记",
    "knowledge.detail": "详情",
    "knowledge.selectAll": "全选",
    "knowledge.selected": "已选",
    "knowledge.bulkClassify": "批量归类",
    "knowledge.statusActive": "生效中",
    "knowledge.statusArchived": "已归档",
    "knowledge.readOnlyHint": "归档笔记仅可查看。",
    "knowledge.emptyList": "当前视图暂无笔记。",
    "knowledge.emptyDetail": "请选择一条笔记查看详情。",
    "knowledge.noticeAppended": "笔记已追加。",
    "knowledge.noticeUpdated": "笔记已更新。",
    "knowledge.noticeArchived": "笔记已归档。",
    "knowledge.noticeDeleted": "笔记已删除。",
    "knowledge.noticeClassified": "归类完成",
    "knowledge.noticeNoChange": "没有可保存的变更。",
    "knowledge.errValidation": "标题、正文和来源为必填。",
    "knowledge.placeholderSearch": "搜索标题或正文",
    "knowledge.placeholderTag": "按标签筛选",
    "knowledge.placeholderTitle": "标题",
    "knowledge.placeholderBody": "正文",
    "knowledge.placeholderTags": "标签1, 标签2",
    "knowledge.placeholderSource": "来源",

    "ideas.title": "想法",
    "ideas.subtitle": "先收集产品/技术想法，再把就绪想法提升为路线节点。",
    "ideas.create": "创建想法",
    "ideas.refresh": "刷新",
    "ideas.filterStatus": "状态",
    "ideas.filterAll": "全部",
    "ideas.placeholderTitle": "想法标题",
    "ideas.placeholderSource": "来源",
    "ideas.placeholderProblem": "这个想法解决什么问题？",
    "ideas.placeholderHypothesis": "你希望验证什么假设？",
    "ideas.emptyList": "当前视图暂无想法。",
    "ideas.emptyDetail": "请选择一个想法查看和操作。",
    "ideas.detail": "想法详情",
    "ideas.problem": "问题",
    "ideas.hypothesis": "假设",
    "ideas.source": "来源",
    "ideas.status": "状态",
    "ideas.updated": "更新时间",
    "ideas.saveStatus": "保存状态",
    "ideas.promote": "提升到路线",
    "ideas.promoteRoute": "目标路线",
    "ideas.promoteNodeType": "节点类型",
    "ideas.promoteAction": "执行提升",
    "ideas.promoteNeedReady": "只有 ready 状态的想法才能提升。",
    "ideas.noticeCreated": "想法已创建。",
    "ideas.noticeUpdated": "想法已更新。",
    "ideas.noticePromoted": "想法已提升为路线节点。",
    "ideas.errNeedRoute": "请先选择目标路线。",
    "ideas.status.captured": "已捕获",
    "ideas.status.triage": "已分诊",
    "ideas.status.discovery": "调研中",
    "ideas.status.ready": "已就绪",
    "ideas.status.rejected": "已拒绝",

    "routes.title": "路线",
    "routes.subtitle": "管理执行路线，并用只读图预览节点依赖关系。",
    "routes.create": "创建路线",
    "routes.refresh": "刷新",
    "routes.filterStatus": "状态",
    "routes.filterAll": "全部",
    "routes.placeholderName": "路线名称",
    "routes.placeholderGoal": "路线目标",
    "routes.placeholderOwner": "负责人",
    "routes.emptyList": "当前视图暂无路线。",
    "routes.emptyDetail": "请选择一条路线查看图结构。",
    "routes.detail": "路线详情",
    "routes.goal": "目标",
    "routes.owner": "负责人",
    "routes.priority": "优先级",
    "routes.status": "状态",
    "routes.updated": "更新时间",
    "routes.saveStatus": "保存状态",
    "routes.nodeCreate": "新增节点",
    "routes.nodeType": "节点类型",
    "routes.nodeTitle": "节点标题",
    "routes.nodeDescription": "节点描述",
    "routes.nodeCreateAction": "创建节点",
    "routes.graphTitle": "路线图（只读）",
    "routes.graphEmpty": "暂无节点，先新增节点即可生成路线图。",
    "routes.graphDependsOn": "依赖",
    "routes.graphBlocks": "影响",
    "routes.graphNoDependsOn": "无上游依赖",
    "routes.graphNoBlocks": "无下游节点",
    "routes.noticeCreated": "路线已创建。",
    "routes.noticeUpdated": "路线已更新。",
    "routes.noticeNodeCreated": "路线节点已创建。",
    "routes.status.candidate": "候选",
    "routes.status.active": "执行中",
    "routes.status.parked": "暂挂",
    "routes.status.completed": "已完成",
    "routes.status.cancelled": "已取消",
    "routes.nodeType.decision": "决策",
    "routes.nodeType.milestone": "里程碑",
    "routes.nodeType.task": "任务",
    "routes.nodeStatus.todo": "待办",
    "routes.nodeStatus.in_progress": "进行中",
    "routes.nodeStatus.done": "已完成",
    "routes.nodeStatus.cancelled": "已取消",

    "audit.title": "审计",
    "audit.subtitle": "追踪 who/when/tool/action/target/source。",
    "audit.load": "加载事件",
    "audit.applyFilters": "应用筛选",
    "audit.clearFilters": "清空",
    "audit.filterAction": "动作",
    "audit.filterTool": "工具",
    "audit.filterActorType": "操作者类型",
    "audit.filterActorId": "操作者ID",
    "audit.filterTargetType": "目标类型",
    "audit.filterTargetId": "目标ID",
    "audit.empty": "当前筛选下没有事件。",
    "audit.eventTime": "时间",
    "audit.eventActor": "操作者",
    "audit.eventTool": "工具",
    "audit.eventAction": "动作",
    "audit.eventTarget": "目标",
    "audit.eventSource": "来源",
    "audit.eventMetadata": "元数据"
  }
};

type I18nValue = {
  lang: Lang;
  setLang: (lang: Lang) => void;
  t: (key: string) => string;
};

const I18nContext = createContext<I18nValue | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLang] = useState<Lang>("en");

  useEffect(() => {
    const saved = window.localStorage.getItem("afkms_lang");
    if (saved === "en" || saved === "zh") {
      setLang(saved);
    }
  }, []);

  useEffect(() => {
    window.localStorage.setItem("afkms_lang", lang);
    document.documentElement.lang = lang === "zh" ? "zh-CN" : "en";
  }, [lang]);

  const value = useMemo<I18nValue>(
    () => ({
      lang,
      setLang,
      t: (key: string) => dictionaries[lang][key] ?? key
    }),
    [lang]
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return ctx;
}
